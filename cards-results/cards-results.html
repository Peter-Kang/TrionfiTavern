<cards-results current-cards="">
  <style>
    .card-mat {
      margin-right: auto;
      margin-left: auto;
      width: 80%;
      height: auto;
      border-radius: 5px;
      background-color: rgba(255, 255, 255, 5%);
      padding: 10px;
      text-align: center;
    }
  </style>
  <div id="mat" class="card-mat"></div>
  <script tl-effect>
    function GetRandomCardNotOnList(cardResult, deckToUse) {
      //get current-cards into a array
      let cardsPicked = new Set(
        cardResult
          .getAttribute("current-cards")
          .trimStart()
          .split(" ")
          .map((x) => Math.abs(x))
      );
      //pick random index not on current-cards
      if (cardsPicked.size < deckToUse.length) {
        let unpickedCards = deckToUse
          .map((card, index) => index.toString())
          .filter((index) => {
            return !cardsPicked.has(Number(index));
          });
        const random_index = Math.floor(Math.random() * unpickedCards.length);
        //check if it is a flipped card
        const isFlipped = Math.floor(Math.random() * 10) == 0;
        const current = cardResult.getAttribute("current-cards");
        const just_picked_value = isFlipped
          ? unpickedCards[random_index] * -1
          : unpickedCards[random_index];
        cardResult.setAttribute(
          "current-cards",
          current + " " + just_picked_value.toString()
        );
        return [deckToUse[unpickedCards[random_index]], isFlipped];
      }
      return null;
    }

    function addCard(cardResult) {
      const [src, isFlipped] = GetRandomCardNotOnList(
        cardResult,
        cardSrcDefault
      );
      const card = createCard(src, isFlipped);
      if (card != null) {
        cardResult.shadowRoot.getElementById("mat").appendChild(card);
      }
    }

    this.addEventListener("deck-draw", (event) => {
      addCard(this);
    });
  </script>
</cards-results>
